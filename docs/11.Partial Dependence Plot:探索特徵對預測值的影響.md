# [Day 11] Partial Dependence Plotï¼šæ¢ç´¢ç‰¹å¾µå°é æ¸¬å€¼çš„å½±éŸ¿
ç¯„ä¾‹ç¨‹å¼ï¼š[![Open In Colab](https://colab.research.google.com/assets/colab-badge.svg)](https://colab.research.google.com/github/andy6804tw/2023-15th-ironman/blob/main/code/11.Partial Dependence Plotï¼šæ¢ç´¢ç‰¹å¾µå°é æ¸¬å€¼çš„å½±éŸ¿.ipynb)


Partial Dependence Plotï¼ˆPDPï¼‰æ˜¯è¦è§€å¯Ÿæ¯ä¸€å€‹è‡ªè®Šæ•¸çš„è®ŠåŒ–æ˜¯å¦‚ä½•å½±éŸ¿é æ¸¬è¡¨ç¾ï¼Œå®ƒå¯ä»¥å¿«é€Ÿåœ°åˆ†æè‡ªè®Šæ•¸èˆ‡ç›®æ¨™è®Šæ•¸ä¹‹é–“çš„é—œä¿‚ã€‚è€Œæ˜¨å¤©æ‰€æçš„ Permutation Importance æ˜¯è¦è§€å¯ŸæŸå€‹ç‰¹å¾µæœƒæœ‰å¤šå¤§çš„ç¨‹åº¦å½±éŸ¿é æ¸¬çš„éŒ¯èª¤ç‡ï¼Œé€²è€Œå–å¾—é‡è¦ç¨‹åº¦æ’åºã€‚é™¤æ­¤ä¹‹å¤– PDP ä¹Ÿèƒ½è€ƒæ…®åˆ°ç‰¹å¾µçš„äº¤äº’ä½œç”¨ï¼Œå¯ä»¥åŒæ™‚è§€å¯Ÿå…©å€‹æˆ–ä»¥ä¸Šçš„ç‰¹å¾µåˆèµ·ä¾†å¦‚ä½•å»å½±éŸ¿é æ¸¬çµæœã€‚ä½†ä»¥å¯¦å‹™é¢ä¾†èªªç‚ºäº†å¯ä»¥è¦–è¦ºåŒ–é æ¸¬çµæœï¼Œé€šå¸¸ PDP æœ€å¤šæœƒåŒæ™‚è€ƒæ…®å…©å€‹ç‰¹å¾µï¼Œå› ç‚ºè¶…éä¸‰å€‹ç¶­åº¦å°±æ¯”è¼ƒé›£ç”¨è¦–è¦ºå»å‘ˆç¾çµæœã€‚ä»Šå¤©è¨è«–çš„æ–¹æ³•ä¹Ÿæ˜¯ä¸€ç¨®èˆ‡æ¨¡å‹ç„¡é—œçš„å¯è§£é‡‹æŠ€è¡“ã€‚

![](./image/img11-1.png)

æˆ‘å€‘å†ä»¥æˆ¿åƒ¹é æ¸¬ç‚ºä¾‹ï¼Œå¯ä»¥å¾ä¸‹é¢é€™å…«å¼µ Partial Dependence åœ–è§€å¯Ÿå“ªäº›ç‰¹å¾µæ˜¯å°æ–¼ yï¼ˆæˆ¿åƒ¹ï¼‰çš„å½±éŸ¿æ˜¯æ¯”è¼ƒæ˜é¡¯çš„ã€‚å…¶ä¸­è¶Šå¹³å¦çš„æ›²ç·šä»£è¡¨è©²ç‰¹å¾µè¶Šä¸é‡è¦ï¼Œé€™æ„å‘³è‘—æˆ‘ä¸ç®¡æ€æ¨£è®Šå‹•è©²ç‰¹å¾µçš„å€¼å°æ–¼é æ¸¬çµæœéƒ½å·®ä¸å¤šï¼Œåä¹‹ï¼Œä¸Šä¸‹èµ·ä¼æ¯”è¼ƒæ˜é¡¯çš„ç·šä»£è¡¨è©²ç‰¹å¾µæ¥µç‚ºé‡è¦ã€‚ä¾‹å¦‚å·¦ä¸Šè§’çš„ä¸­ä½æ•¸æ”¶å…¥ï¼Œå¾ä¸­æˆ‘å€‘å¯ä»¥ç™¼ç¾ï¼Œè©²ç‰¹å¾µå°æ¨¡å‹é æ¸¬ä¾†èªªåªè¦ç¨å¾®è®Šå‹•ä¸€å€‹å–®ä½å°æ–¼è¼¸å‡ºçµæœæœ‰æ˜é¡¯çš„å½±éŸ¿ã€‚åŒæ™‚å¯ä»¥èªªæ˜è©²ç‰¹å¾µå¾ç¾é‡‘ 1.58 åˆ° 7.23 è¬ç¾å…ƒï¼Œéš¨è‘—æ”¶å…¥é€æ¼¸åœ°å¢é•·ï¼Œå½±éŸ¿è©²åœ°å€çš„æˆ¿åƒ¹æ˜¯æ­£ç›¸é—œçš„ã€‚

![](./image/img11-2.png)

> æˆ‘å€‘å¯ä»¥é€é PDP é€ä¸€è§€å¯Ÿæ¯å€‹ç‰¹å¾µè·Ÿè¼¸å‡ºçš„é—œä¿‚ã€‚

## Partial Dependence æ¼”ç®—æ³•æµç¨‹
æ¥ä¸‹ä¾†è¦ä¾†è¨è«– Partial Dependence æ˜¯å¦‚ä½•è¢«è¨ˆç®—å‡ºä¾†çš„ã€‚é¦–å…ˆæˆ‘å€‘æœ‰ä¸€çµ„è¨“ç·´è³‡æ–™å…±æœ‰ d å€‹ç‰¹å¾µï¼Œå› æ­¤è¨“ç·´ä¸€å€‹æ¨¡å‹ f è¼¸å…¥ç‚º x1~xdï¼Œç›®æ¨™æ˜¯è¦é æ¸¬ yã€‚é€éè’™åœ°å¡ç¾…æ³•å¸Œæœ›å¯ä»¥è§€å¯ŸæŸå€‹ xj ç‰¹å¾µçš„å€¼å®ƒçš„ç›¸å°æ‡‰è¼¸å‡ºæ˜¯å¤šå°‘ã€‚å› æ­¤æˆ‘å€‘å¯ä»¥å¾è¨“ç·´é›†ä¸­æŠ½å– m ç­†è³‡æ–™æ¨£æœ¬ï¼Œä¸¦å°‡è¦è¢«è§€å¯Ÿçš„ç‰¹å¾µ xj å›ºå®šä¸€å€‹æ•¸å€¼ tï¼Œè€Œå…¶ä»–çš„ç‰¹å¾µå°±ç”¨å‰›å‰›éš¨æ©ŸæŠ½å‡ºçš„æ¨£æœ¬ä¾åºå¸¶å€¼é€²å»ã€‚æ¯æ¬¡å¸¶ä¸€ç­†é€²å»å¾Œéƒ½æœƒè¼¸å‡ºä¸€å€‹ yï¼Œç¸½å…±æœƒå¾—åˆ° m å€‹çµæœæœ€çµ‚åœ¨å¹³å‡å–ä¾†çš„æ•¸å€¼å°±æ˜¯ xj å°æ–¼ t çš„æƒ…æ³ä¸‹æ‰€ä¼°è¨ˆçš„çµæœã€‚

![](./image/img11-6.png)

1. å¾æ¸¬è©¦é›†æˆ–è³‡æ–™é›†ä¸­ï¼Œéš¨æ©Ÿå–å‡ºä¸€å€‹æ¨£æœ¬ğ‘§
2. æŠŠğ‘§çš„ç‰¹å¾µ ğ‘¥ğ‘— æ”¹ç‚º ğ‘¡ï¼Œå…¶ä»–ç‰¹å¾µä¸è®Šï¼Œå¾—åˆ°æ–°æ¨£æœ¬ğ‘§â€²
3. é€éè¨“ç·´å¥½çš„æ¨¡å‹ï¼Œå¾—åˆ°æ–°æ¨£æœ¬çš„é æ¸¬å€¼ Å·â€²=ğ‘“(ğ‘§â€²)
4. é‡è¤‡ä»¥ä¸Šæ­¥é©Ÿ m æ¬¡ï¼Œå¾—åˆ° m å€‹é æ¸¬å€¼ Å·â€²1,Å·â€²2,...,Å·â€²m
5. è¨ˆç®—å¹³å‡å€¼ï¼Œå³ç‚º ğ‘“(ğ‘¥ğ‘—=ğ‘¡) çš„ä¼°è¨ˆå€¼ã€‚
6. é‡è¤‡ä»¥ä¸Šæ­¥é©Ÿï¼Œå¾—åˆ°å…¶ä»–ç‰¹å¾µçš„ PDPã€‚

> è‡³æ–¼tè¦æœ‰å¹¾å€‹å–æ±ºæ–¼è©²ç‰¹å¾µçš„ä¸Šä¸‹ç•Œï¼Œä¸¦é€égrid_resolutionåƒæ•¸è¨­å®šè¦åœ¨é€™ç¯„åœé–“å–å¾—å¹¾çµ„åšç‚ºtã€‚

é€™è£¡èˆ‰å€‹ä¾‹å­ï¼Œæˆ‘å€‘æƒ³è¦ç”¨èº«é«˜å’Œé«”é‡å…©å€‹ç‰¹å¾µå»é æ¸¬ä¸€å€‹äººçš„è¡€å£“ã€‚å‡è¨­æˆ‘å€‘è¦è§€å¯Ÿé«”é‡50å…¬æ–¤çš„è¡€å£“æ˜¯å¤šå°‘ï¼Œæˆ‘å€‘æœƒå…ˆå¾è³‡æ–™é›†ä¸­æ¡æ¨£ m ç­†è³‡æ–™(é€™è£¡æœ‰å››ç­†ï¼Œm=4)ã€‚æ¥è‘—å¾é€™å››ç­†è³‡æ–™ä¸­å›ºå®šé«”é‡éƒ½æ”¹æˆ50ï¼Œå…¶é¤˜èº«é«˜ä¿å€¼ä¸è®Šä¸¦æ”¾å…¥äº‹å…ˆè¨“ç·´å¥½çš„æ¨¡å‹é€²è¡Œé æ¸¬å¾—åˆ° Å·ã€‚æœ€çµ‚æŠŠé€™å››å€‹æ¨¡å‹é æ¸¬çš„ Å· åŠ ç¸½åšå¹³å‡å°±å¯ä»¥å¾—åˆ°é æ¸¬é«”é‡ 50 å…¬æ–¤çš„äººå¹³å‡çš„è¡€å£“æ˜¯å¤šå°‘ã€‚åŒæ¨£ä»¥æ­¤æ¦‚å¿µæˆ‘å€‘å¯ä»¥å¾—åˆ°éš¨è‘—é«”é‡çš„è®ŠåŒ–(60kg, 70kg...)æ¨¡å‹é æ¸¬å‡ºä¾†çš„è¡€å£“æ‡‰è©²æ˜¯å¤šå°‘ã€‚

![](./image/img11-7.png)

## åŸºæ–¼ Partial Dependence çš„ç‰¹å¾µé‡è¦æ€§åˆ†æ
åœ¨ä¹‹å‰çš„å…§å®¹ä¸­ï¼Œæˆ‘å€‘å·²ç¶“å­¸åˆ°å¦‚æœä¸€å€‹ç‰¹å¾µçš„ Partial Dependence Plotï¼ˆPDPï¼‰ å‘ˆç¾å‡ºã€Œå¹³å¦ã€çš„æ›²ç·šï¼Œä»£è¡¨è©²ç‰¹å¾µå°ç›®æ¨™è®Šæ•¸çš„å½±éŸ¿ä¸é‡è¦ã€‚ä½†æ˜¯ï¼Œå¦‚ä½•æ¸¬é‡ä¸€å€‹æ›²ç·šçš„ã€Œå¹³å¦åº¦ã€å‘¢ï¼Ÿå…¶ä¸­ä¸€å€‹æ–¹æ³•æ˜¯ä½¿ç”¨æ¨™æº–å·®ä¾†è¡¡é‡å…¶åå¹³å¦åº¦ã€‚å¦‚æœæˆ‘å€‘è©•ä¼°äº†å‡½æ•¸ ğ‘“j(xj=vk)ï¼ˆå…¶ä¸­k=1,...,Kï¼‰ï¼Œå‰‡ç‰¹å¾µ xj çš„é‡è¦æ€§å¯ä»¥å®šç¾©ç‚ºå…¶æ¨™æº–å·®ã€‚è¨ˆç®—å®Œæ¯å€‹ç‰¹å¾µçš„æ¨™æº–å·®å¾Œï¼Œå…¶æ¨™æº–å·®è¶Šå¤§çš„ç‰¹å¾µæˆ‘å€‘å¯ä»¥è¦–ç‚ºè¶Šé‡è¦ã€‚

![](./image/img11-8.png)

ä½¿ç”¨ PDP å°‹æ‰¾é‡è¦ç‰¹å¾µæ™‚å¿…é ˆè¦æ³¨æ„è³‡æ–™çš„åˆç†æ€§ï¼Œæ€éº¼èªªå‘¢ï¼Ÿè‹¥ xj èˆ‡å…¶ä»–ç‰¹å¾µå­˜åœ¨æŸç¨®é—œä¿‚ï¼Œæˆ‘å€‘éš¨æ©ŸæŠ½å–æ¨£æœ¬å¡«å…¥å¯èƒ½æŠ½åˆ°æ¥µä¸åˆç†çš„ç‰¹å¾µçµ„åˆã€‚ä¾‹å¦‚ä¸Šé¢çš„é æ¸¬è¡€å£“ä¾‹å­ç•¶ä¸­å¯èƒ½æœƒç”¢ç”Ÿ(èº«é«˜180cm,é«”é‡40kg)çš„æ¥µç«¯çµ„åˆï¼Œé€™ç¨®æƒ…å½¢ç¾å¯¦ç”Ÿæ´»ä¸­è¼ƒé›£å‡ºç¾æ­¤æ¡ˆä¾‹ï¼Œå› æ­¤å¯èƒ½éŒ¯ä¼°çµæœã€‚

## PDP å°æ–¼è³‡æ–™ç•°è³ªæ€§çš„å½±éŸ¿
é›–ç„¶ PDP æœ‰åŠ©æ–¼å¯è¦–åŒ–é æ¸¬éŸ¿æ‡‰èˆ‡ä¸€å€‹æˆ–å¤šå€‹ç‰¹å¾µä¹‹é–“çš„å¹³å‡éƒ¨åˆ†ç›¸ä¾é—œä¿‚ã€‚ä½†åœ¨å­˜åœ¨å¯¦è³ªäº¤äº’ä½œç”¨å½±éŸ¿ä¸‹ï¼Œéƒ¨åˆ†éŸ¿æ‡‰é—œä¿‚å¯èƒ½æ˜¯ç•°è³ªçš„ï¼ˆheterogeneitiesï¼‰ã€‚å› æ­¤åƒ PDP é€™æ¨£çš„å¹³å‡æ›²ç·šå¯èƒ½æœƒæ©è“‹å»ºæ¨¡é—œä¿‚çš„è¤‡é›œæ€§ã€‚æ‰€ä»¥æˆ‘å€‘å¯ä»¥é€é ICE åœ–ç¹ªè£½å€‹åˆ¥è§€æ¸¬å€¼çš„é æ¸¬éŸ¿æ‡‰èˆ‡ç‰¹å¾µä¹‹é–“çš„å‡½æ•¸é—œä¿‚ä¾†æ”¹é€²éƒ¨åˆ†ç›¸ä¾åœ–ã€‚åœ¨ä¸‹åœ– a ä¸­ï¼Œæˆ‘å€‘ç¹ªè£½äº†æ¨£æœ¬ä¸­çš„ X2 èˆ‡ Y çš„æ•£é»åœ–ã€‚åœ– b é¡¯ç¤ºäº†é æ¸¬ç‰¹å¾µ X2 çš„æ“¬åˆæ¨¡å‹çš„éƒ¨åˆ†ç›¸ä¾åœ–ã€‚PDP é¡¯ç¤ºå°±å¹³å‡è€Œè¨€ï¼ŒX2 èˆ‡é æ¸¬çš„ Y æ²’æœ‰é¡¯è‘—çš„ç›¸é—œæ€§ã€‚ä½†æ˜¯å¾åœ– a ä¸­å¯ä»¥æ˜é¡¯çœ‹å‡ºï¼Œé€™å€‹çµè«–æ˜¯éŒ¯èª¤çš„ã€‚å¾ˆæ˜é¡¯ X2 èˆ‡ Y æœ‰é—œè¯ï¼Œåªæ˜¯ PDP ä¸­çš„å¹³å‡åŒ–æ©è“‹äº†é€™ä¸€ç™¼ç¾ã€‚å› æ­¤ PDP çš„ç¼ºé»åœ¨æ–¼å¯èƒ½æ©è“‹è³‡æ–™ä¸­çš„ç•°è³ªæ€§ã€‚å› æ­¤é‚„æœ‰å¦ä¸€ç¨®è®Šå½¢æ˜¯å€‹é«”æ¢ä»¶æœŸæœ›åœ–ï¼ˆICE Plotï¼‰ï¼Œå¦‚åœ– c æ‰€ç¤ºã€‚ICE plot å¯ä»¥æ¸…æ¥šåœ°é¡¯ç¤ºé æ¸¬å€¼å’Œç‰¹å¾µ X2 ä¹‹é–“çš„é—œä¿‚ã€‚å¾ä¸­æˆ‘å€‘å¯ä»¥ç™¼ç¾ï¼Œæ­¤æ¨¡å‹çš„é æ¸¬å€¼åœ¨ç‰¹å¾µ X2 çš„ä¸åŒå€åŸŸå…§å‘ˆç¾è¿‘ä¼¼ç·šæ€§å¢åŠ æˆ–æ¸›å°‘çš„è¶¨å‹¢ã€‚

![](./image/img11-9.png)

## ICE Plot
å‰›å‰›çš„ä¾‹å­ä¸­ PDP åœ¨å±•ç¤ºå–®ä¸€ç‰¹å¾µå°é æ¸¬å€¼çš„å½±éŸ¿æ™‚ï¼Œå¯èƒ½æœƒæ©è“‹æ‰ç‰¹å¾µå’Œå…¶ä»–ç‰¹å¾µä¹‹é–“çš„äº¤äº’ä½œç”¨ï¼Œé€²è€Œé™åˆ¶äº† PDP çš„è§£é‡‹èƒ½åŠ›ã€‚ç‚ºäº†å…‹æœé€™å€‹å•é¡Œï¼Œåœ¨ç¯‡è«–æ–‡ï¼š[Peeking Inside the Black Box: Visualizing Statistical Learning with Plots of Individual Conditional Expectation](https://arxiv.org/pdf/1309.6392.pdf) ä½œè€…æå‡ºäº† ICE plotï¼ˆIndividual Conditional Expectation plotï¼‰çš„æ¦‚å¿µï¼Œå¯ä»¥æ›´å¥½åœ°å±•ç¤ºç‰¹å¾µä¹‹é–“çš„äº¤äº’ä½œç”¨ã€‚ICE plot é¡ä¼¼æ–¼ PDPï¼Œä½†æ˜¯å®ƒç¹ªè£½çš„æ˜¯æ¯å€‹è§€æ¸¬å€¼çš„å€‹åˆ¥æ¢ç·šï¼Œå› æ­¤å¯ä»¥æ›´å¥½åœ°å‘ˆç¾ç‰¹å¾µä¹‹é–“çš„å·®ç•°å’Œäº¤äº’ä½œç”¨ã€‚

1. å¾æ¸¬è©¦é›†æˆ–è³‡æ–™é›†ä¸­ï¼Œéš¨æ©Ÿå–å‡ºä¸€å€‹æ¨£æœ¬ğ‘§
2. æŠŠğ‘§çš„ç‰¹å¾µ ğ‘¥ğ‘— æ”¹ç‚º ğ‘¡ï¼Œå…¶ä»–ç‰¹å¾µä¸è®Šï¼Œå¾—åˆ°æ–°æ¨£æœ¬ğ‘§â€²
3. é€éè¨“ç·´å¥½çš„æ¨¡å‹ï¼Œå¾—åˆ°æ–°æ¨£æœ¬çš„é æ¸¬å€¼ Å·â€²=ğ‘“(ğ‘§â€²)
4. é‡è¤‡ä»¥ä¸Šæ­¥é©Ÿ m æ¬¡ï¼Œå¾—åˆ° m å€‹é æ¸¬å€¼ Å·â€²1,Å·â€²2,...,Å·â€²m
5. å°‡é€™ m å€‹é æ¸¬å€¼èˆ‡åŸå§‹æ¨£æœ¬ğ‘§çš„ç‰¹å¾µğ‘¥ğ‘—çš„å€¼ä¸€èµ·ç•«åœ¨åœ–ä¸Š
6. é‡è¤‡ä»¥ä¸Šæ­¥é©Ÿï¼Œå¾—åˆ°å…¶ä»–ç‰¹å¾µçš„ ICE Plotã€‚

## sklearn å¯¦ä½œ Partial Dependence
åœ¨ sklearn ä¸­æœ‰æä¾›å…©ç¨® PDP çš„ API åˆ†åˆ¥ç‚º partial_dependence å’Œ PartialDependenceDisplayï¼Œå…©è€…æ˜¯ç”¨æ–¼å‘ˆç¾éƒ¨åˆ†ç›¸ä¾ (partial dependence) çš„å·¥å…·ï¼Œä½†å®ƒå€‘çš„ä½¿ç”¨æ–¹å¼å’Œé¡¯ç¤ºæ•ˆæœæœ‰æ‰€ä¸åŒã€‚

- partial_dependence æ˜¯ä¸€å€‹å‡½æ•¸ï¼Œå¯ç”¨ä¾†è¨ˆç®—éƒ¨åˆ†ç›¸ä¾å€¼ä¸¦è¿”å›çµæœã€‚
- PartialDependenceDisplay å¯ä»¥ç›´æ¥ç¹ªè£½éƒ¨åˆ†ç›¸ä¾åœ–ï¼Œé€éè¦–è¦ºåŒ–æ–¹æ³•æ¯”è¼ƒä¸åŒç‰¹å¾µçš„å½±éŸ¿ã€‚

> æœ¬æ—¥çš„å…§å®¹å»ºè­°åœ¨ Python 3.8 å’Œ scikit-learn 1.2.2 ç‰ˆæœ¬ä»¥ä¸ŠåŸ·è¡Œã€‚

![](./image/img11-3.png)

> åƒè€ƒ: [sklearn.inspection: Inspection](https://scikit-learn.org/stable/modules/classes.html#module-sklearn.inspection)


ä»Šå¤©çš„ç¯„ä¾‹å»¶çºŒæ˜¨å¤©çš„æˆ¿åƒ¹é æ¸¬è³‡æ–™é›†ï¼Œä¸¦å…ˆè¨“ç·´å¥½éš¨æ©Ÿæ£®æ—è¿´æ­¸æ¨¡å‹ã€‚

```py
from sklearn.datasets import fetch_california_housing
from sklearn.model_selection import train_test_split
from sklearn.ensemble import RandomForestRegressor
import numpy as np
import pandas as pd

# è¼‰å…¥åŠ å·åœ°å€æˆ¿å±‹åƒ¹æ ¼é æ¸¬è³‡æ–™é›†
data = fetch_california_housing()
feature_names = np.array(data.feature_names)
X, y = data.data, data.target

# åˆ‡åˆ†è³‡æ–™é›†ç‚ºè¨“ç·´é›†å’Œæ¸¬è©¦é›†
X_train, X_test, y_train, y_test = train_test_split(X, y, random_state=42)

# è¨“ç·´éš¨æ©Ÿæ£®æ—è¿´æ­¸æ¨¡å‹
model = RandomForestRegressor(random_state=0).fit(X, y)
```

æ¥è‘—æ˜¯æœ¬æ—¥å¯¦ä½œé‡é»ï¼Œé€™è£¡æ¡ç”¨ `PartialDependenceDisplay` æ–¹æ³•æ­é… from_estimator æ”¾å…¥äº‹å…ˆè¨“ç·´å¥½çš„ sklearn æ¨¡å‹ï¼Œä¸¦æ”¾å…¥æ¸¬è©¦è³‡æ–™é›†é€²è¡Œå…¨åŸŸçš„æ¨¡å‹è§£é‡‹ã€‚ä»¥ä¸‹æ˜¯è©²æ–¹æ³•å¸¸ç”¨åˆ°çš„åƒæ•¸ï¼Œè‹¥æƒ³æ›´é€²éšä½¿ç”¨å¯ä»¥åƒè€ƒå®˜æ–¹[æ–‡ä»¶](https://scikit-learn.org/stable/modules/generated/sklearn.inspection.PartialDependenceDisplay.html)ã€‚

Parameters:
- estimator: å·²è¨“ç·´çš„é æ¸¬å™¨ç‰©ä»¶ï¼Œå¿…é ˆå¯¦ä½œ predictã€predict_proba æˆ– decision_function æ–¹æ³•ã€‚
- X: å¯æ”¾å…¥è¨“ç·´è³‡æ–™æˆ–æ˜¯æ¸¬è©¦è³‡æ–™é›†ï¼Œå¦å¤–è¦æ³¨æ„æ˜¯å¦æœ‰å‰è™•ç†ã€‚
- features: éœ€è¦åˆ†æçš„ç‰¹å¾µï¼Œå¯ä»¥ç‚ºä¸€å€‹æˆ–å¤šå€‹ç‰¹å¾µï¼Œè‹¥ç‚ºä¸€å€‹å‰‡ç”Ÿæˆå–®ç‰¹å¾µçš„éƒ¨åˆ†ç›¸ä¾åœ–ï¼Œè‹¥å…©å€‹å‰‡ç”Ÿæˆ2-wayéƒ¨åˆ†ç›¸ä¾åœ–ï¼ˆkind='average'æ™‚æ‰æ”¯æ´ï¼‰ï¼Œæ¯å€‹å…ƒç´ å¯ä»¥æ˜¯ç‰¹å¾µç´¢å¼•æˆ–ç‰¹å¾µåç¨±æˆ–ç‰¹å¾µç´¢å¼•æˆ–ç‰¹å¾µåç¨±çš„tupleã€‚
- categorical_features: PDPä¹Ÿæ”¯æ´é¡åˆ¥å‹çš„ç‰¹å¾µè§£é‡‹ï¼Œç”¨æ³•è·Ÿ features ä¸€æ¨£ã€‚
- feature_names: ç”¨æ–¼æŒ‡å®šæ¯å€‹ç‰¹å¾µçš„åç¨±ï¼Œé è¨­å€¼ç‚ºNoneã€‚
- grid_resolution: ç¶²æ ¼è§£æåº¦ï¼Œæ•¸å€¼è¶Šå¤§è¶Šèƒ½å‘ˆç¾ç‰¹å¾µèˆ‡ç›®æ¨™è®Šæ•¸ä¹‹é–“çš„é—œä¿‚ï¼Œé è¨­å€¼ç‚º100ã€‚
- percentiles: ç”¨æ–¼é™åˆ¶PDPçš„Xè»¸ä¸Šä¸‹ç•Œï¼Œä»¥ç™¾åˆ†ä½æ•¸è¡¨ç¤ºï¼Œé è¨­å€¼ç‚º(0.05, 0.95)ã€‚
- centered: æ˜¯å¦å°‡ICEå’ŒPDç·šçš„èµ·å§‹é»è¨­ç‚ºyè»¸åŸé»å¾0é–‹å§‹ï¼Œé è¨­ç‚ºFalseã€‚
- kind: ä»¥å­—ä¸²æ ¼å¼è¨­å®šï¼Œæä¾›ä¸‰ç¨®ç¹ªè£½å½¢å¼ 'average' å°±æ˜¯å–®ç´”çš„PDPç¹ªè£½;'individual' ç¹ªè£½ICE plot;'both' å‰‡ä»£è¡¨åŒæ™‚ç¹ªè£½PDèˆ‡ICE plotã€‚é è¨­ç‚º'average'ã€‚

```py
from sklearn.inspection import PartialDependenceDisplay

PartialDependenceDisplay.from_estimator(model,X_test, ['MedInc'], 
                                        feature_names=feature_names, 
                                        centered =False, 
                                        kind='average', 
                                        percentiles=(0, 1),
                                        grid_resolution=100)
```

è¼¸å‡ºçµæœï¼š
![](./image/img11-4.png)

è©¦è‘—å°‡åƒæ•¸ä¿®æ”¹ `kind='both'`ï¼Œæˆ‘å€‘å°±å¯ä»¥åŒæ™‚å¾—åˆ° ICE Plot ä»¥åŠä¸­é–“æ©˜è‰²ç·šæ¢å°±æ˜¯æ¯å€‹æ¨£æœ¬å¹³å‡å¾Œçš„ PDPã€‚

![](./image/img11-5.png)


## Reference
- Friedman, Jerome H. "[Greedy function approximation: A gradient boosting machine.](https://projecteuclid.org/journals/annals-of-statistics/volume-29/issue-5/Greedy-function-approximation-A-gradient-boostingmachine/10.1214/aos/1013203451.full)" Annals of statistics (2001): 1189-1232.
- Alex goldstein. (2014). [Peeking Inside the Black Box: Visualizing Statistical Learning with Plots of Individual Conditional Expectation](https://arxiv.org/pdf/1309.6392.pdf). Arxiv.